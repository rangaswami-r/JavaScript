<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Tic-Tac-Toe</title>
<style>
  #game-container {
    width: 100%;
    text-align: center;
  }
  #board {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    grid-gap: 5px;
    width: 315px;
    margin: 20px auto;
  }
  .cell {
    width: 100px;
    height: 100px;
    background: #eee;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    cursor: pointer;
  }
  .cell:hover {
    background: #ddd;
  }
  .cell.disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  .winner {
    background: #aaffaa;
  }
  #status, #history {
    font-size: 1.2em;
    margin-bottom: 10px;
  }
  #history > div {
    margin-bottom: 5px;
  }
  #board-size {
    margin-top: 20px;
  }
  #board-size > button {
    margin: 5px;
  }
</style>
</head>
<body>

<div id="game-container">
  <div id="status">Select board size to start the game.</div>
  <div id="board-size">
    <button onclick="initGame(3)">3x3</button>
    <button onclick="initGame(4)">4x4</button>
    <button onclick="initGame(5)">5x5</button>
  </div>
  <div id="board"></div>
  <div id="history">
    <div>Player X's last move: <span id="x-last-move">-</span></div>
    <div>Player O's last move: <span id="o-last-move">-</span></div>
  </div>
</div>

<script>
  let boardSize;
  let currentPlayer = 'X';
  let moves = { 'X': [], 'O': [] };
  let history = { 'X': [], 'O': [] };
  let winPatterns;
  let cells;

  function initGame(size) {
    boardSize = size;
    document.getElementById('board-size').style.display = 'none';
    const board = document.getElementById('board');
    board.style.gridTemplateColumns = `repeat(${size}, 100px)`;
    board.innerHTML = '';
    for (let i = 0; i < size * size; i++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.index = i;
      board.appendChild(cell);
    }
    cells = document.querySelectorAll('.cell');
    winPatterns = generateWinPatterns(size);
    cells.forEach((cell, index) => {
      cell.onclick = () => makeMove(cell, index);
    });
  }

  function generateWinPatterns(size) {
    const patterns = [];
    // Rows and columns
    for (let i = 0; i < size; i++) {
      const row = Array.from({length: size}, (_, j) => i * size + j);
      const col = Array.from({length: size}, (_, j) => j * size + i);
      patterns.push(row, col);
    }
    // Diagonals
    const diagonal1 = Array.from({length: size}, (_, i) => i * size + i);
    const diagonal2 = Array.from({length: size}, (_, i) => (size - 1 - i) * size + i);
    patterns.push(diagonal1, diagonal2);
    return patterns;
  }

  function makeMove(cell, index) {
    if (!cell.textContent && !cell.classList.contains('disabled')) {
      cell.textContent = currentPlayer;
      moves[currentPlayer].push(index);
      history[currentPlayer].push(index);
      document.getElementById(`${currentPlayer.toLowerCase()}-last-move`).textContent = index + 1;

      const winner = checkWinner([...cells].map(c => c.textContent));
      if (winner) {
        document.getElementById('status').textContent = `Player ${winner} wins!`;
        disableAllCells();
        return;
      }
      if (moves.X.length + moves.O.length === boardSize * boardSize) {
        document.getElementById('status').textContent = 'Game ends in a draw!';
        return;
      }

      if (moves[currentPlayer].length > boardSize - 1) {
        const oldestMove = moves[currentPlayer].shift();
        cells[oldestMove].textContent = '';
      }

      currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
      document.getElementById('status').textContent = `Player ${currentPlayer}'s Turn`;
    }
  }

  function checkWinner(board) {
    for (let pattern of winPatterns) {
      const firstSymbol = board[pattern[0]];
      if (firstSymbol && pattern.every(index => board[index] === firstSymbol)) {
        return firstSymbol;
      }
    }
    return null;
  }

  function disableAllCells() {
    cells.forEach(cell => {
      cell.classList.add('disabled');
      cell.onclick = null;
    });
  }
</script>

</body>
</html>
