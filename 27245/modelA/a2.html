<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Tic-Tac-Toe</title>
<style>
  body { font-family: Arial, sans-serif; }
  #game-container {
    text-align: center;
    margin-top: 20px;
  }
  #board {
    display: grid;
    margin: 20px auto;
    grid-gap: 5px;
  }
  .cell {
    width: 60px;
    height: 60px;
    background: #eee;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    cursor: pointer;
  }
  .cell:hover { background: #ddd; }
  .winner { background: #aaffaa; }
  #status, #move-history {
    margin: 10px 0;
    font-size: 1.2em;
  }
  #move-history div {
    margin: 5px 0;
  }
  #size-selector {
    margin-bottom: 20px;
  }
</style>
</head>
<body>

<div id="game-container">
  <h1>Tic-Tac-Toe</h1>
  <div id="size-selector">
    <label for="board-size">Choose Board Size:</label>
    <select id="board-size">
      <option value="3">3x3</option>
      <option value="4">4x4</option>
      <option value="5">5x5</option>
    </select>
    <button onclick="startGame()">Start Game</button>
  </div>
  <div id="status">Select board size to start</div>
  <div id="board"></div>
  <div id="move-history">
    <div><strong>Last Moves:</strong></div>
    <div id="playerXMove">X: -</div>
    <div id="playerOMove">O: -</div>
  </div>
</div>

<script>
let boardSize = 3;
let currentPlayer = 'X';
let gameActive = false;
let moves = {'X': [], 'O': []};
let boardState = [];

function startGame() {
    boardSize = parseInt(document.getElementById('board-size').value);
    gameActive = true;
    currentPlayer = 'X';
    moves = {'X': [], 'O': []};
    boardState = Array(boardSize * boardSize).fill(null);
    document.getElementById('status').textContent = `Player ${currentPlayer}'s Turn`;
    renderBoard();
}

function renderBoard() {
    const board = document.getElementById('board');
    board.style.gridTemplateColumns = `repeat(${boardSize}, 60px)`;
    board.innerHTML = '';
    for (let i = 0; i < boardSize * boardSize; i++) {
        let cell = document.createElement('div');
        cell.className = 'cell';
        cell.setAttribute('data-index', i);
        cell.onclick = () => makeMove(i);
        board.appendChild(cell);
    }
}

function checkWinner() {
    const winLength = boardSize >= 5 ? 5 : boardSize; // For 5x5, need 5 in a row to win
    const check = (a, b, c, d, e = null) => {
        if (e === null && boardState[a] && boardState[a] === boardState[b] && boardState[a] === boardState[c]) return boardState[a];
        if (boardState[a] && boardState[a] === boardState[b] && boardState[a] === boardState[c] && boardState[a] === boardState[d] && boardState[a] === boardState[e]) return boardState[a];
        return null;
    };

    for (let i = 0; i < boardSize; i++) {
        for (let j = 0; j < boardSize; j++) {
            // Check rows, columns, and diagonals
            if (j <= boardSize - winLength) {
                if (check(i*boardSize+j, i*boardSize+j+1, i*boardSize+j+2, i*boardSize+j+3, i*boardSize+j+4)) return true;
            }
            if (i <= boardSize - winLength) {
                if (check(i*boardSize+j, (i+1)*boardSize+j, (i+2)*boardSize+j, (i+3)*boardSize+j, (i+4)*boardSize+j)) return true;
            }
            // Diagonals
            if (i <= boardSize - winLength && j <= boardSize - winLength) {
                if (check(i*boardSize+j, (i+1)*boardSize+j+1, (i+2)*boardSize+j+2, (i+3)*boardSize+j+3, (i+4)*boardSize+j+4)) return true;
                if (check((i+winLength-1)*boardSize+j, (i+winLength-2)*boardSize+j+1, (i+winLength-3)*boardSize+j+2, (i+winLength-4)*boardSize+j+3, (i+winLength-5)*boardSize+j+4)) return true;
            }
        }
    }
    return false;
}

function makeMove(index) {
    if (!gameActive || boardState[index]) return;

    boardState[index] = currentPlayer;
    moves[currentPlayer].push(index);

    if (moves[currentPlayer].length > 2) {
        let oldestMove = moves[currentPlayer].shift();
        boardState[oldestMove] = null;
        document.querySelector(`[data-index="${oldestMove}"]`).textContent = '';
    }

    document.querySelector(`[data-index="${index}"]`).textContent = currentPlayer;
    document.getElementById(`player${currentPlayer}Move`).textContent = `${currentPlayer}: (${Math.floor(index/boardSize)+1}, ${index%boardSize+1})`;

    if (checkWinner()) {
        document.getElementById('status').textContent = `Player ${currentPlayer} wins!`;
        gameActive = false;
        return;
    }

    if (boardState.filter(cell => cell === null).length === 0) {
        document.getElementById('status').textContent = "It's a draw!";
        gameActive = false;
        return;
    }

    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
    document.getElementById('status').textContent = `Player ${currentPlayer}'s Turn`;
}

</script>

</body>
</html>
