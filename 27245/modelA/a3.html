<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Power-Up Tic-Tac-Toe</title>
<style>
  #game-container {
    width: 100%;
    text-align: center;
  }
  #board {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    grid-gap: 5px;
    width: 315px;
    margin: 20px auto;
  }
  .cell {
    width: 100px;
    height: 100px;
    background: #eee;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    cursor: pointer;
  }
  .cell:hover {
    background: #ddd;
  }
  .cell.disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  .winner {
    background: #aaffaa;
  }
  #status, #history, #power-ups {
    font-size: 1.2em;
    margin-bottom: 10px;
  }
  #history > div, #power-ups > div {
    margin-bottom: 5px;
  }
  #board-size, #player-names {
    margin-top: 20px;
  }
  #board-size > button, #player-names > input, #player-names > button {
    margin: 5px;
  }
  .power-up {
    padding: 5px 10px;
    margin: 0 5px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="game-container">
  <div id="player-names">
    <input type="text" id="playerX" placeholder="Player X">
    <input type="text" id="playerO" placeholder="Player O">
    <button onclick="startGame()">Start Game</button>
  </div>
  <div id="board-size" style="display:none;">
    <button onclick="initGame(3)">3x3</button>
    <button onclick="initGame(4)">4x4</button>
    <button onclick="initGame(5)">5x5</button>
  </div>
  <div id="status">Waiting for player names...</div>
  <div id="board"></div>
  <div id="history">
    <div><span id="x-name"></span>'s last move: <span id="x-last-move">-</span></div>
    <div><span id="o-name"></span>'s last move: <span id="o-last-move">-</span></div>
  </div>
  <div id="power-ups">
    <button class="power-up" id="undo" onclick="usePowerUp('undo')">Undo Move</button>
    <button class="power-up" id="swap" onclick="usePowerUp('swap')">Swap Turns</button>
  </div>
</div>

<script>
  let boardSize, currentPlayer = 'X', players = { 'X': '', 'O': '' };
  let moves = { 'X': [], 'O': [] }, history = { 'X': [], 'O': [] };
  let winPatterns, cells, powerUps = { 'undo': 1, 'swap': 1 };

  function startGame() {
    players['X'] = document.getElementById('playerX').value || 'Player X';
    players['O'] = document.getElementById('playerO').value || 'Player O';
    document.getElementById('player-names').style.display = 'none';
    document.getElementById('board-size').style.display = 'block';
    document.getElementById('status').textContent = 'Select board size to start the game.';
  }

  function initGame(size) {
    boardSize = size;
    setupBoard();
    document.getElementById('x-name').textContent = players['X'];
    document.getElementById('o-name').textContent = players['O'];
    updateStatus();
  }

  function setupBoard() {
    // Setup board UI similar to previous example...
    // Generate win patterns, initialize cells, etc.
  }

  function makeMove(cell, index) {
    if (!cell.textContent && !cell.classList.contains('disabled')) {
      // Existing move logic...
      // After move, check power-ups
      if (powerUps['undo'] > 0) document.getElementById('undo').disabled = false;
    }
  }

  function usePowerUp(type) {
    if (powerUps[type] > 0) {
      powerUps[type]--;
      document.getElementById(type).disabled = true;
      switch(type) {
        case 'undo':
          undoMove();
          break;
        case 'swap':
          currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
          updateStatus();
          break;
      }
    }
  }

  function undoMove() {
    if (history[currentPlayer].length > 0) {
      let lastMoveIndex = history[currentPlayer].pop();
      cells[lastMoveIndex].textContent = '';
      moves[currentPlayer].pop();
      // If there was a move before the last one, redo it for the other player
      if (history[currentPlayer === 'X' ? 'O' : 'X'].length > 0) {
        let redoIndex = history[currentPlayer === 'X' ? 'O' : 'X'].pop();
        cells[redoIndex].textContent = currentPlayer === 'X' ? 'O' : 'X';
        moves[currentPlayer === 'X' ? 'O' : 'X'].push(redoIndex);
      }
    }
    updateStatus();
  }

  function updateStatus() {
    document.getElementById('status').textContent = `${players[currentPlayer]}'s Turn`;
  }

  // ... rest of the functions like checkWinner, disableAllCells, etc. remain largely unchanged
</script>

</body>
</html>
