<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Snake Game</title>
<style>
    body { background: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    #gameCanvas { background: #000; }
    #gameOver, #highScores { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3em; display: none; }
    #highScores { font-size: 1em; }
    #scores { position: absolute; top: 10px; left: 10px; color: #fff; }
    .powerup { position: absolute; background: yellow; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="400"></canvas>
<div id="gameOver">Game Over!</div>
<div id="highScores">High Scores:<br></div>
<div id="scores">Player: <span id="playerName"></span><br>Score: <span id="score">0</span><br>High Score: <span id="highScore">0</span></div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const gameOverDiv = document.getElementById('gameOver');
    const highScoresDiv = document.getElementById('highScores');
    const scoresDiv = document.getElementById('scores');
    const playerNameSpan = document.getElementById('playerName');
    const scoreSpan = document.getElementById('score');
    const highScoreSpan = document.getElementById('highScore');

    let playerName = prompt('Enter your name:');
    playerNameSpan.textContent = playerName;
    let snake = [{x: 200, y: 200}];
    let food = {x: Math.floor(Math.random() * 39) * 10, y: Math.floor(Math.random() * 39) * 10};
    let dx = 10, dy = 0;
    let score = 0;
    let highScore = localStorage.getItem(playerName) || 0;
    let speed = 100;
    let powerUpTimer = 0;
    let powerUpType = null;
    let highScores = JSON.parse(localStorage.getItem('highScores')) || [];

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        snake.forEach(drawSnakePart);
        drawFood();
        if (powerUpType) drawPowerUp();
    }

    function drawSnakePart(part) {
        ctx.fillStyle = 'green';
        ctx.fillRect(part.x, part.y, 10, 10);
    }

    function drawFood() {
        ctx.fillStyle = 'red';
        ctx.fillRect(food.x, food.y, 10, 10);
    }

    function drawPowerUp() {
        ctx.fillStyle = 'yellow';
        ctx.fillRect(powerUpType.x, powerUpType.y, 10, 10);
    }

    function moveSnake() {
        const head = {x: snake[0].x + dx, y: snake[0].y + dy};
        snake.unshift(head);
        if (powerUpType && head.x === powerUpType.x && head.y === powerUpType.y) {
            activatePowerUp(powerUpType.type);
            powerUpType = null;
        } else if (head.x === food.x && head.y === food.y) {
            score += 10;
            if (speed > 30) speed -= 5;
            generateFood();
        } else {
            snake.pop();
        }
    }

    function generateFood() {
        food = {x: Math.floor(Math.random() * 39) * 10, y: Math.floor(Math.random() * 39) * 10};
        if (Math.random() < 0.1) generatePowerUp();
    }

    function generatePowerUp() {
        const types = ['speedBoost', 'slowMotion', 'invincibility'];
        const type = types[Math.floor(Math.random() * types.length)];
        powerUpType = {x: Math.floor(Math.random() * 39) * 10, y: Math.floor(Math.random() * 39) * 10, type: type};
    }

    function activatePowerUp(type) {
        if (type === 'speedBoost') speed /= 2;
        if (type === 'slowMotion') speed *= 2;
        if (type === 'invincibility') {
            // Implement invincibility logic here
        }
        powerUpTimer = 5000; // 5 seconds timer
        setTimeout(() => {
            if (type === 'speedBoost') speed *= 2;
            if (type === 'slowMotion') speed /= 2;
            powerUpTimer = 0;
        }, powerUpTimer);
    }

    function checkCollision() {
        const head = snake[0];
        if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) return true;
        for(let i = 1; i < snake.length; i++) {
            if (head.x === snake[i].x && head.y === snake[i].y) return true;
        }
        return false;
    }

    function gameLoop() {
        if (checkCollision()) {
            gameOver();
            return;
        }
        setTimeout(function onTick() {
            moveSnake();
            draw();
            updateScoreDisplay();
            gameLoop();
        }, speed);
    }

    function updateScoreDisplay() {
        scoreSpan.textContent = score;
        if (score > highScore) {
            highScore = score;
            localStorage.setItem(playerName, highScore);
        }
        highScoreSpan.textContent = highScore;
    }

    function gameOver() {
        gameOverDiv.style.display = 'block';
        updateHighScores();
    }

    function updateHighScores() {
        highScores.push({name: playerName, score: score});
        highScores.sort((a, b) => b.score - a.score);
        highScores = highScores.slice(0, 10);
        localStorage.setItem('highScores', JSON.stringify(highScores));
        displayHighScores();
    }

    function displayHighScores() {
        highScoresDiv.innerHTML = 'High Scores:<br>';
        highScores.forEach((entry, index) => {
            highScoresDiv.innerHTML += `${index + 1}. ${entry.name}: ${entry.score}<br>`;
        });
        highScoresDiv.style.display = 'block';
    }

    document.addEventListener('keydown', event => {
        const keyPressed = event.keyCode;
        const directions = {37: [-10, 0], 38: [0, -10], 39: [10, 0], 40: [0, 10]};
        if (directions[keyPressed]) {
            dx = directions[keyPressed][0];
            dy = directions[keyPressed][1];
        }
    });

    gameLoop();
    displayHighScores();
</script>
</body>
</html>
