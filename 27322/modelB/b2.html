<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Enhanced Snake Game</title>
<style>
    body { background: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: Arial, sans-serif; }
    #gameCanvas { background: #000; }
    #gameOver, #startScreen { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; background: rgba(0, 0, 0, 0.8); padding: 20px; border-radius: 10px; text-align: center; }
    #gameOver { display: none; }
    #scoreBoard { position: absolute; top: 10px; left: 10px; color: white; }
    #powerUp { position: absolute; background: yellow; width: 10px; height: 10px; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="400"></canvas>
<div id="startScreen">
    <h2>Welcome to Snake!</h2>
    <input type="text" id="playerName" placeholder="Enter your name" />
    <button onclick="startGame()">Start Game</button>
</div>
<div id="gameOver">
    <h2>Game Over!</h2>
    <p id="finalScore"></p>
    <button onclick="location.reload()">Play Again</button>
</div>
<div id="scoreBoard">
    <div>Score: <span id="currentScore">0</span></div>
    <div>High Score: <span id="highScore">0</span></div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startScreen = document.getElementById('startScreen');
    const gameOverDiv = document.getElementById('gameOver');
    const playerNameInput = document.getElementById('playerName');
    const currentScoreDisplay = document.getElementById('currentScore');
    const highScoreDisplay = document.getElementById('highScore');

    let snake = [{x: 200, y: 200}];
    let food = {x: 0, y: 0};
    let dx = 10, dy = 0;
    let changingDirection = false;
    let score = 0;
    let speed = 100;
    let playerName = "";
    let highScore = 0;
    let powerUp = null;
    let powerUpTimer = 0;
    const powerUpTypes = ['speedBoost', 'invincibility', 'slowMotion'];

    // Load high scores from localStorage
    let highScores = JSON.parse(localStorage.getItem('snakeHighScores') || '[]');

    function drawSnakePart(part) {
        ctx.fillStyle = 'green';
        ctx.fillRect(part.x, part.y, 10, 10);
    }

    function drawFood() {
        ctx.fillStyle = 'red';
        ctx.fillRect(food.x, food.y, 10, 10);
    }

    function drawPowerUp() {
        if (powerUp) {
            ctx.fillStyle = 'yellow';
            ctx.fillRect(powerUp.x, powerUp.y, 10, 10);
        }
    }

    function clearCanvas() {
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function moveSnake() {
        const head = {x: snake[0].x + dx, y: snake[0].y + dy};
        snake.unshift(head);
        if (head.x === food.x && head.y === food.y) {
            score += 10;
            if (score > highScore) highScore = score;
            if (speed > 30) speed -= 5;
            generateFood();
        } else {
            snake.pop();
        }
        checkPowerUpCollision();
    }

    function generateFood() {
        food.x = Math.floor(Math.random() * 40) * 10;
        food.y = Math.floor(Math.random() * 40) * 10;
        generatePowerUp();
    }

    function generatePowerUp() {
        if (Math.random() < 0.02) { // 2% chance
            powerUp = {x: Math.floor(Math.random() * 40) * 10, y: Math.floor(Math.random() * 40) * 10, type: powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)]};
        } else {
            powerUp = null;
        }
    }

    function checkPowerUpCollision() {
        if (powerUp && snake[0].x === powerUp.x && snake[0].y === powerUp.y) {
            applyPowerUp(powerUp.type);
            powerUp = null;
        }
    }

    function applyPowerUp(type) {
        if (type === 'speedBoost') speed = 50;
        if (type === 'slowMotion') speed = 200;
        if (type === 'invincibility') {
            // Implement invincibility logic if needed
        }
        powerUpTimer = 5; // 5 seconds timer
    }

    function checkCollision() {
        const head = snake[0];
        if (head.x < 0 || head.x >= 400 || head.y < 0 || head.y >= 400) return true;
        for(let i = 1; i < snake.length; i++) {
            if (head.x == snake[i].x && head.y == snake[i].y) return true;
        }
        return false;
    }

    function changeDirection(event) {
        const keyMap = {37: 'left', 39: 'right', 38: 'up', 40: 'down', 65: 'left', 68: 'right', 87: 'up', 83: 'down'};
        const direction = keyMap[event.keyCode];
        if (!direction || changingDirection) return;
        changingDirection = true;

        const goingUp = dy === -10, goingDown = dy === 10, goingRight = dx === 10, goingLeft = dx === -10;
        if ((direction === 'left' && !goingRight) || (direction === 'right' && !goingLeft) ||
            (direction === 'up' && !goingDown) || (direction === 'down' && !goingUp)) {
            dx = (direction === 'right') ? 10 : (direction === 'left' ? -10 : 0);
            dy = (direction === 'down') ? 10 : (direction === 'up' ? -10 : 0);
        }
    }

    function gameLoop() {
        if (checkCollision()) {
            endGame();
            return;
        }
        changingDirection = false;
        setTimeout(function onTick() {
            clearCanvas();
            drawFood();
            drawPowerUp();
            moveSnake();
            if (powerUpTimer > 0) {
                powerUpTimer--;
                if (powerUpTimer === 0) speed = 100; // Reset speed after power-up effect
            }
            snake.forEach(drawSnakePart);
            currentScoreDisplay.textContent = score;
            highScoreDisplay.textContent = highScore;
            gameLoop();
        }, speed);
    }

    function startGame() {
        playerName = playerNameInput.value || "Player";
        startScreen.style.display = 'none';
        highScore = highScores.find(score => score.name === playerName)?.score || 0;
        gameLoop();
    }

    function endGame() {
        gameOverDiv.style.display = 'block';
        document.getElementById('finalScore').textContent = `Your Score: ${score}`;
        updateHighScores();
    }

    function updateHighScores() {
        highScores.push({name: playerName, score: score});
        highScores.sort((a, b) => b.score - a.score);
        highScores = highScores.slice(0, 10); // Keep only top 10
        localStorage.setItem('snakeHighScores', JSON.stringify(highScores));
    }

    document.addEventListener('keydown', changeDirection);
    generateFood();
</script>
</body>
</html>
